<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agente Gemini</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = { darkMode: 'class' }
</script>
<style>
    body { font-family: 'Inter', sans-serif; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .modal-overlay { background-color: rgba(0, 0, 0, 0.5); }
</style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

<div class="container mx-auto p-4 md:p-8 flex flex-col md:flex-row h-screen">

    <!-- Contenido principal -->
    <div class="flex-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col mr-0 md:mr-6 mb-6 md:mb-0 transition-colors duration-300">

        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-blue-600 dark:text-blue-400">🤖 Agente Gemini</h1>
            <div class="flex items-center space-x-2">
                <button id="guide-button" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 focus:outline-none hover:ring-2 ring-blue-500">❓</button>
                <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 focus:outline-none hover:ring-2 ring-blue-500">
                    <span id="theme-icon">🌙</span>
                </button>
            </div>
        </div>

        <!-- Contenedor de guía e historial -->
        <div id="content-area" class="flex-1 overflow-y-auto scrollbar-hide mb-6 p-2 space-y-4">
            <div id="guide-section">
                <h2 class="text-2xl font-semibold mb-4">Bienvenido al Agente Gemini</h2>
                <p class="text-gray-600 dark:text-gray-400 mb-6">Escribe tu comando para empezar a interactuar con el agente.</p>
            </div>
            <div id="history" class="space-y-6"></div>
            <div id="loading-indicator" class="hidden text-center text-blue-500 italic">Cargando...</div>
        </div>

        <!-- Formulario de entrada - IDs CORREGIDOS -->
        <form id="commandForm" class="flex mt-auto">
            <input type="text" id="user_input" class="flex-1 p-3 rounded-l-full border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100" placeholder="Escribe tu comando aquí" required>
            <button type="submit" class="p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-r-full focus:outline-none focus:ring-2 ring-blue-500 transition-colors">Enviar</button>
        </form>

        <!-- Contenedor RMN + Documentos -->
        <div id="rmn-document-container" class="flex flex-col mt-6 space-y-6">

            <!-- RMN -->
            <div>
                <button id="rmn-toggle" onclick="toggleRMNSection()" class="w-full text-left p-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg transition-colors cursor-pointer">
                    🧪 Espectros RMN ▶
                </button>
                <div id="rmn-section" class="hidden mt-4 space-y-4">
                    <!-- Ayuda RMN -->
                    <div class="bg-green-50 dark:bg-green-900 p-3 rounded-lg">
                        <div class="text-sm text-green-700 dark:text-green-300 mb-2">
                            <strong>🔬 Limpiador de Espectros RMN</strong><br>
                            Elimina ruido y mejora la calidad de tus espectros
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="showRMNHelp()" class="text-xs px-2 py-1 bg-green-200 hover:bg-green-300 dark:bg-green-700 dark:hover:bg-green-600 text-green-800 dark:text-green-200 rounded transition-colors">📖 Ayuda</button>
                            <button onclick="showRMNMethods()" class="text-xs px-2 py-1 bg-green-200 hover:bg-green-300 dark:bg-green-700 dark:hover:bg-green-600 text-green-800 dark:text-green-200 rounded transition-colors">🔧 Métodos</button>
                            <button onclick="listSpectra()" class="text-xs px-2 py-1 bg-green-200 hover:bg-green-300 dark:bg-green-700 dark:hover:bg-green-600 text-green-800 dark:text-green-200 rounded transition-colors">📊 Ver espectros</button>
                        </div>
                    </div>

                    <!-- Subir Espectros -->
                    <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 dark:text-blue-200 mb-3">📊 Subir Espectros (.csv, .txt, .dat, .json)</h4>
                        <input type="file" id="spectrum-file-input" accept=".csv,.txt,.dat,.asc,.json" class="block w-full text-sm text-gray-500 dark:text-gray-400 mb-3 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-800 dark:file:text-blue-200 dark:hover:file:bg-blue-700">
                        <button onclick="uploadSpectrum()" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium">📤 Subir Espectro</button>
                        <div class="text-xs text-blue-600 dark:text-blue-400 mt-2 italic">💡 Formato esperado: dos columnas (ppm/frecuencia, intensidad)</div>
                        <div id="spectra-list" class="mt-3"></div>
                    </div>

                    <!-- Métodos de Limpieza -->
                    <div class="bg-purple-50 dark:bg-purple-900 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800 dark:text-purple-200 mb-3">🔧 Métodos de Limpieza</h4>
                        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                            <button onclick="quickCleanAuto()" class="px-2 py-1 bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors font-semibold">🤖 Auto</button>
                            <button onclick="quickCleanSavgol()" class="px-2 py-1 bg-purple-200 hover:bg-purple-300 dark:bg-purple-700 dark:hover:bg-purple-600 text-purple-800 dark:text-purple-200 rounded transition-colors">📈 Savgol</button>
                            <button onclick="quickCleanGaussian()" class="px-2 py-1 bg-purple-200 hover:bg-purple-300 dark:bg-purple-700 dark:hover:bg-purple-600 text-purple-800 dark:text-purple-200 rounded transition-colors">🌊 Gaussiano</button>
                            <button onclick="quickCleanMedian()" class="px-2 py-1 bg-purple-200 hover:bg-purple-300 dark:bg-purple-700 dark:hover:bg-purple-600 text-purple-800 dark:text-purple-200 rounded transition-colors">🎯 Mediana</button>
                        </div>
                    </div>

                    <!-- Estado RMN -->
                    <div class="bg-green-50 dark:bg-green-900 p-3 rounded-lg">
                        <div class="text-xs text-green-700 dark:text-green-300 text-center">
                            <strong>📊 Estado RMN</strong><br>
                            <span id="rmn-stats">Espectros: 0 | Limpios: 0 | Gráficos: 0</span>
                        </div>
                    </div>

                    <div id="cleaned-spectra" class="mt-4 space-y-4"></div>
                </div>
            </div>

            <!-- Documentos -->
            <div>
                <button id="document-toggle" onclick="toggleDocumentSection()" class="w-full text-left p-3 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-lg transition-colors cursor-pointer">
                    📄 Documentos ▶
                </button>
                <div id="document-section" class="hidden mt-4 space-y-4">
                    <!-- Subir Plantillas -->
                    <div class="bg-yellow-50 dark:bg-yellow-900 p-4 rounded-lg">
                        <h4 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-3">📑 Subir Plantilla</h4>
                        <input type="file" id="template-file-input" accept=".docx,.pdf,.txt,.md,.odt" class="block w-full text-sm text-gray-500 dark:text-gray-400 mb-3">
                        <button onclick="uploadTemplate()" class="w-full px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors font-medium">📤 Subir Plantilla</button>
                    </div>
                    <!-- Subir Datos -->
                    <div class="bg-indigo-50 dark:bg-indigo-900 p-4 rounded-lg">
                        <h4 class="font-semibold text-indigo-800 dark:text-indigo-200 mb-3">📊 Subir Datos</h4>
                        <input type="file" id="data-file-input" accept=".csv,.json,.xlsx,.ods" class="block w-full text-sm text-gray-500 dark:text-gray-400 mb-3">
                        <button onclick="uploadDataFile()" class="w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors font-medium">📤 Subir Datos</button>
                    </div>
                    <!-- Listas de archivos -->
                    <div id="templates-list"></div>
                    <div id="data-files-list"></div>
                    <div id="output-files-list"></div>
                </div>
            </div>

        </div>
    </div>

    <!-- Panel lateral -->
    <div class="w-full md:w-80 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col transition-colors duration-300">
        <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">💾 Archivos Guardados</h2>
        <div id="files-list" class="flex-1 overflow-y-auto space-y-4 scrollbar-hide">
            <!-- Código -->
            <div id="code-files-container">
                <h3 class="font-semibold text-lg text-gray-700 dark:text-gray-300 mb-2">💻 Código</h3>
                <div id="code-files-list" class="space-y-2 mb-4"></div>
            </div>
            <!-- Notas -->
            <div id="notes-section">
                <h3 class="font-semibold text-lg text-gray-700 dark:text-gray-300 mb-2">📝 Notas</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 italic text-center mb-2">Cargando...</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal Guía -->
<div id="guide-keywords-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 z-50 max-w-4xl w-full max-h-[90vh] overflow-y-auto scrollbar-hide">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200">📘 Guía de Uso</h2>
            <button id="close-guide-keywords-modal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <div class="space-y-6">
            <div class="p-4 bg-yellow-100 dark:bg-yellow-800 rounded-xl">
                <h3 class="font-bold text-yellow-800 dark:text-yellow-100 text-lg">📝 Notas</h3>
                <ul class="mt-2 list-disc list-inside text-sm">
                    <li><strong>Guardar:</strong> <code>guardar: tu nota aquí</code></li>
                    <li><strong>Ver todas:</strong> <code>leer</code></li>
                    <li><strong>Buscar:</strong> <code>buscar: término</code></li>
                    <li><strong>Borrar:</strong> <code>borrar</code></li>
                </ul>
            </div>

            <div class="p-4 bg-green-100 dark:bg-green-800 rounded-xl">
                <h3 class="font-bold text-green-800 dark:text-green-100 text-lg">💻 Código</h3>
                <ul class="mt-2 list-disc list-inside text-sm">
                    <li><strong>Guardar:</strong> <code>script.py||print("Hola")</code></li>
                    <li><strong>Generar:</strong> <code>generar: script de calculadora</code></li>
                </ul>
            </div>

            <div class="p-4 bg-blue-100 dark:bg-blue-800 rounded-xl">
                <h3 class="font-bold text-blue-800 dark:text-blue-100 text-lg">🔍 Búsqueda</h3>
                <ul class="mt-2 list-disc list-inside text-sm">
                    <li><strong>Buscar web:</strong> <code>buscar python tutorials</code></li>
                    <li><strong>Abrir URL:</strong> <code>https://www.google.com</code></li>
                </ul>
            </div>

            <div class="p-4 bg-purple-100 dark:bg-purple-800 rounded-xl">
                <h3 class="font-bold text-purple-800 dark:text-purple-100 text-lg">🧮 Calculadora</h3>
                <ul class="mt-2 list-disc list-inside text-sm">
                    <li><strong>Calcular:</strong> <code>2 + 2 * (3 - 1)</code></li>
                    <li><strong>Potencias:</strong> <code>(100 / 2) ** 2</code></li>
                </ul>
            </div>

            <div class="p-4 bg-indigo-100 dark:bg-indigo-800 rounded-xl">
                <h3 class="font-bold text-indigo-800 dark:text-indigo-100 text-lg">🧪 Espectros RMN</h3>
                <ul class="mt-2 list-disc list-inside text-sm">
                    <li><strong>Analizar:</strong> <code>analizar: espectro.csv</code></li>
                    <li><strong>Limpiar auto:</strong> <code>limpiar auto: espectro.csv</code></li>
                    <li><strong>Métodos:</strong> <code>métodos</code></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    const guideKeywordsModal = document.getElementById("guide-keywords-modal");
    const guideButton = document.getElementById("guide-button");
    const closeGuideKeywordsButton = document.getElementById("close-guide-keywords-modal");

    guideButton.addEventListener("click", () => guideKeywordsModal.classList.remove("hidden"));
    closeGuideKeywordsButton.addEventListener("click", () => guideKeywordsModal.classList.add("hidden"));
    guideKeywordsModal.addEventListener("click", (e) => {
        if(e.target === guideKeywordsModal) guideKeywordsModal.classList.add("hidden");
    });
</script>

<script src="/static/js/rmn.js"></script>
<script src="/static/script.js"></script>
<script type="module" src="/static/js/document.js"></script>
</body>
</html>